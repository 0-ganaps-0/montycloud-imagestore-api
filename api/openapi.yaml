
openapi: 3.0.3
info:
  title: Images Service API
  version: 1.0.0
servers:
  - url: http://localhost:4566/restapis/{apiId}/dev/_user_request_
    variables:
      apiId:
        default: YOUR_API_ID
paths:
  /images:
    post:
      summary: Upload image with metadata
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UploadRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageItem'
    get:
      summary: List images
      parameters:
        - in: query
          name: user_id
          schema: { type: string }
        - in: query
          name: tag
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, default: 20 }
        - in: query
          name: last_evaluated_key
          schema: { type: string, description: Base64-encoded pagination token }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/ImageItem' }
                  next_token:
                    type: string
  /images/{image_id}:
    get:
      summary: Get image metadata
      parameters:
        - in: path
          name: image_id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ImageItem' }
        '404':
          description: Not Found
    delete:
      summary: Delete image
      parameters:
        - in: path
          name: image_id
          required: true
          schema: { type: string }
      responses:
        '204':
          description: No Content
  /images/{image_id}/download:
    get:
      summary: Get a pre-signed download URL
      parameters:
        - in: path
          name: image_id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string

components:
  schemas:
    UploadRequest:
      type: object
      required: [user_id, title, tags, content_type, image_base64]
      properties:
        user_id: { type: string }
        title: { type: string }
        description: { type: string }
        tags: { type: array, items: { type: string } }
        content_type: { type: string }
        image_base64: { type: string, description: Base64-encoded bytes }
    ImageItem:
      type: object
      properties:
        image_id: { type: string }
        user_id: { type: string }
        title: { type: string }
        description: { type: string }
        tags: { type: array, items: { type: string } }
        content_type: { type: string }
        s3_bucket: { type: string }
        s3_key: { type: string }
        size: { type: integer }
        checksum: { type: string }
        created_at: { type: string }
